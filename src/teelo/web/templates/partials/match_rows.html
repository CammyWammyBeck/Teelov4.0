{% macro circuit_bg(tour, level) %}
{% if level == 'Grand Slam' %}bg-[#D4AF37]{% elif tour in ['ATP'] %}bg-[#002865]{% elif tour in ['WTA'] %}bg-[#E30066]{% elif tour in ['CHALLENGER', 'Challenger'] %}bg-[#006B3F]{% elif tour in ['WTA 125', 'WTA_125'] or level in ['WTA 125', 'WTA_125'] %}bg-[#9D174D]{% elif tour == 'ITF' or (level and 'ITF' in level) %}bg-[#4B5563]{% else %}bg-gray-600{% endif %}
{% endmacro %}

{% macro circuit_label(tour, level) %}
{% if level == 'Grand Slam' %}GSL{% elif tour in ['CHALLENGER', 'Challenger'] %}CHL{% elif tour in ['WTA 125', 'WTA_125'] or level in ['WTA 125', 'WTA_125'] %}125{% elif tour == 'ITF' or (level and 'ITF' in level) %}ITF{% elif tour == 'WTA' %}WTA{% elif tour == 'ATP' %}ATP{% else %}UNK{% endif %}
{% endmacro %}

{% macro gender_label(gender, tour) %}
{% if gender == 'women' %}Women{% elif gender == 'men' %}Men{% elif tour in ['WTA', 'WTA 125', 'WTA_125'] %}Women{% elif tour in ['ATP', 'CHALLENGER', 'Challenger'] %}Men{% else %}Unknown{% endif %}
{% endmacro %}

{% macro gender_dot_cls(gender, tour) %}
{% if gender == 'women' or tour in ['WTA', 'WTA 125', 'WTA_125'] %}bg-pink-500{% elif gender == 'men' or tour in ['ATP', 'CHALLENGER', 'Challenger'] %}bg-blue-500{% else %}bg-gray-400{% endif %}
{% endmacro %}

{% macro level_context(gender, tour, level) %}
{{ gender_label(gender, tour) }} • {{ level or 'Unknown' }}
{% endmacro %}

{% macro surface_cls(surface) %}
{% if surface == 'Hard' %}text-[#3B82F6]{% elif surface == 'Clay' %}text-[#EA580C]{% elif surface == 'Grass' %}text-green-600{% endif %}
{% endmacro %}

{% macro elo_badge(player) %}
{% if player.elo_pre is not none %}<span class="text-[11px] text-gray-400 font-normal">{{ player.elo_pre }}{% if player.elo_change is not none %} <span class="{% if player.elo_change > 0 %}text-green-600{% elif player.elo_change < 0 %}text-red-500{% else %}text-gray-400{% endif %}">{{ "+%d"|format(player.elo_change) if player.elo_change >= 0 else player.elo_change }}</span>{% endif %}</span>{% endif %}
{% endmacro %}

{% macro render_table_rows(matches) %}
{% for m in matches %}
{% set is_winner_a = m.winner_id == m.player_a.id %}
{% set is_winner_b = m.winner_id == m.player_b.id %}
{% set score_display = 'W/O' if m.status == 'walkover' else (m.score or 'vs') %}
<tr class="hover:bg-gray-50/50 transition-colors duration-75 group border-l-4 border-transparent hover:border-teelo-lime">
    <td class="px-5 py-3">
        <div class="flex items-center gap-2">
            <span class="{{ circuit_bg(m.tour, m.tournament_level) }} text-white text-[10px] px-1.5 py-0.5 rounded font-bold tracking-tight flex-shrink-0">{{ circuit_label(m.tour, m.tournament_level) }}</span>
            <div class="min-w-0">
                <span class="text-sm font-semibold text-teelo-dark truncate block" title="{{ m.tournament_name or 'Unknown' }}">{{ m.tournament_name or 'Unknown' }}</span>
                <span class="text-xs text-gray-400 inline-flex items-center gap-1.5 flex-wrap">
                    <span>{{ m.round or '' }}</span>
                    <span>·</span>
                    <span class="inline-flex items-center gap-1">
                        <span class="w-1.5 h-1.5 rounded-full {{ gender_dot_cls(m.gender, m.tour) }}"></span>
                        <span class="text-gray-500 font-medium">{{ level_context(m.gender, m.tour, m.tournament_level) }}</span>
                    </span>
                    <span>·</span>
                    <span class="{{ surface_cls(m.surface) }}">{{ m.surface or '' }}</span>
                </span>
            </div>
        </div>
    </td>
    <td class="px-5 py-3 text-right">
        <div class="flex items-center justify-end gap-2">
            <div class="flex flex-col items-end">
                <span class="text-sm {% if is_winner_a %}text-teelo-dark font-bold{% else %}text-gray-400{% endif %}">{{ m.player_a.name }}</span>
                {{ elo_badge(m.player_a) }}
            </div>
            {% if is_winner_a %}
            <i data-lucide="check" class="w-3.5 h-3.5 text-teelo-lime flex-shrink-0"></i>
            {% endif %}
        </div>
    </td>
    <td class="px-5 py-3 text-center">
        <span class="inline-block px-2.5 py-1 bg-gray-50 rounded-md text-xs font-mono text-teelo-dark font-semibold whitespace-nowrap group-hover:bg-teelo-lime/10 transition-colors">{{ score_display }}</span>
    </td>
    <td class="px-5 py-3">
        <div class="flex items-center gap-2">
            {% if is_winner_b %}
            <i data-lucide="check" class="w-3.5 h-3.5 text-teelo-lime flex-shrink-0"></i>
            {% endif %}
            <div class="flex flex-col">
                <span class="text-sm {% if is_winner_b %}text-teelo-dark font-bold{% else %}text-gray-400{% endif %}">{{ m.player_b.name }}</span>
                {{ elo_badge(m.player_b) }}
            </div>
        </div>
    </td>
    <td class="px-5 py-3 text-right">
        <span class="text-xs text-gray-400 whitespace-nowrap">{{ m.match_date_display or '' }}</span>
    </td>
</tr>
{% endfor %}
{% endmacro %}

{% macro render_cards(matches) %}
{% for m in matches %}
{% set is_winner_a = m.winner_id == m.player_a.id %}
{% set is_winner_b = m.winner_id == m.player_b.id %}
{% set score_display = 'W/O' if m.status == 'walkover' else (m.score or 'vs') %}
<div class="px-4 py-3 hover:bg-gray-50/50 transition-colors">
    <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-2 min-w-0">
            <span class="{{ circuit_bg(m.tour, m.tournament_level) }} text-white text-[10px] px-1.5 py-0.5 rounded font-bold tracking-tight flex-shrink-0">{{ circuit_label(m.tour, m.tournament_level) }}</span>
            <span class="text-sm font-semibold text-teelo-dark truncate">{{ m.tournament_name or 'Unknown' }}</span>
        </div>
        <span class="text-xs text-gray-400 flex-shrink-0 ml-2">{{ m.match_date_display or '' }}</span>
    </div>
    <div class="text-xs text-gray-400 mb-2.5 pl-[42px] inline-flex items-center gap-1.5 flex-wrap">
        <span>{{ m.round or '' }}</span>
        <span>·</span>
        <span class="inline-flex items-center gap-1">
            <span class="w-1.5 h-1.5 rounded-full {{ gender_dot_cls(m.gender, m.tour) }}"></span>
            <span class="text-gray-500 font-medium">{{ level_context(m.gender, m.tour, m.tournament_level) }}</span>
        </span>
        <span>·</span>
        <span class="{{ surface_cls(m.surface) }}">{{ m.surface or '' }}</span>
    </div>
    <div class="flex items-center gap-3 pl-[42px]">
        <div class="flex-1 min-w-0">
            <div class="flex items-center gap-1.5 {% if is_winner_a %}text-teelo-dark font-bold{% else %}text-gray-400{% endif %} text-sm">
                {% if is_winner_a %}<i data-lucide="check" class="w-3.5 h-3.5 text-teelo-lime flex-shrink-0"></i>{% endif %}
                <span class="truncate">{{ m.player_a.name }}</span>
                {{ elo_badge(m.player_a) }}
            </div>
            <div class="flex items-center gap-1.5 {% if is_winner_b %}text-teelo-dark font-bold{% else %}text-gray-400{% endif %} text-sm mt-0.5">
                {% if is_winner_b %}<i data-lucide="check" class="w-3.5 h-3.5 text-teelo-lime flex-shrink-0"></i>{% endif %}
                <span class="truncate">{{ m.player_b.name }}</span>
                {{ elo_badge(m.player_b) }}
            </div>
        </div>
        <span class="px-2.5 py-1 bg-gray-50 rounded-md text-xs font-mono text-teelo-dark font-semibold whitespace-nowrap flex-shrink-0">{{ score_display }}</span>
    </div>
</div>
{% endfor %}
{% endmacro %}
